<form #parentForm="ngForm">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Relation</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Occupation</th>
        <th>Qualification</th>
        <th>Age</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let parent of parentGuardians; let i = index">
        <ng-container *ngIf="editIndex === i; else viewMode">
          <td>
            <input type="text" [(ngModel)]="parent.name" name="name{{i}}" #name="ngModel" required />
            <div *ngIf="name.invalid && name.touched" class="error">Name is required</div>
          </td>
          <td>
            <select [(ngModel)]="parent.relationType" name="relationType{{i}}" #relationType="ngModel" required>
              <option value="">Select</option>
              <option value="Guardian">Guardian</option>
              <option value="Father">Father</option>
              <option value="Mother">Mother</option>
            </select>
            <div *ngIf="relationType.invalid && relationType.touched" class="error">Relation is required</div>
          </td>
          <td>
            <input
            type="text"
            [(ngModel)]="parent.phoneNumber"
            name="phone{{i}}"
            #phone="ngModel"
            required
            pattern="^[6-9][0-9]{9}$"
          />
          
          <div *ngIf="phone.errors?.['required'] && phone.touched" class="error">
            Mobile number is required
          </div>
          <div *ngIf="phone.errors?.['pattern'] && phone.touched" class="error">
            Enter valid 10-digit mobile
          </div>
                    </td>
          <td>
            <input type="email" [(ngModel)]="parent.email" name="email{{i}}" #email="ngModel" required />
            <div *ngIf="email.invalid && email.touched" class="error">Enter valid email</div>
          </td>
          <td>
            <input type="text" [(ngModel)]="parent.occupation" name="occupation{{i}}" #occupation="ngModel" required />
            <div *ngIf="occupation.invalid && occupation.touched" class="error">Occupation required</div>
          </td>
          <td>
            <input type="text" [(ngModel)]="parent.qualification" name="qualification{{i}}" #qualification="ngModel" required />
            <div *ngIf="qualification.invalid && qualification.touched" class="error">Qualification required</div>
          </td>
          <td>
            <input type="number" [(ngModel)]="parent.age" name="age{{i}}" #age="ngModel" required min="18" max="100" />
            <div *ngIf="age.invalid && age.touched" class="error">Age must be 18 or more</div>
          </td>
          <td>
            <button mat-button (click)="saveParentGuardian(parent)" [disabled]="!parentForm.form.valid">Save</button>
            <button mat-button (click)="cancelEdit()">Cancel</button>
          </td>
        </ng-container>

        <ng-template #viewMode>
          <td>{{ parent.name }}</td>
          <td>{{ parent.relationType }}</td>
          <td>{{ parent.phoneNumber }}</td>
          <td>{{ parent.email }}</td>
          <td>{{ parent.occupation }}</td>
          <td>{{ parent.qualification }}</td>
          <td>{{ parent.age }}</td>
          <td>
            <button mat-button (click)="editEntry(i)">Edit</button>
            <button mat-button (click)="deleteEntry(parent.guardianId)">Delete</button>
          </td>
        </ng-template>
      </tr>
    </tbody>
  </table>

  <!-- Add New Button -->
  <div>
    <button mat-stroked-button (click)="addNewEntry()">+ Add Another</button>
  </div>
</form>

<!-- Optional styling for errors -->
<style>
  .error {
    color: red;
    font-size: 12px;
  }
</style>
